<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
  <title>Судоку</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- Система тем на CSS-переменных --- */
    :root, body[data-theme="purple"] { --primary-color: #a855f7; --primary-hover: #9333ea; --text-accent: #c084fc; --body-bg: #030712; --container-bg: #111827; --cell-bg: #1f2937; --grid-line: #4b5563; --given-text: #ffffff; --error-text: #f87171; --highlight-bg: var(--primary-color); --highlight-text: var(--given-text); --area-highlight-bg: rgba(168, 85, 247, 0.06); --active-cell-bg: rgba(168, 85, 247, 0.12); }
    body[data-theme="orange"] { --primary-color: #f97316; --primary-hover: #ea580c; --text-accent: #fb923c; --body-bg: #0c0a09; --container-bg: #1c1917; --cell-bg: #292524; --grid-line: #57534e; --given-text: #ffffff; --error-text: #f87171; --highlight-bg: var(--primary-color); --highlight-text: var(--given-text); --area-highlight-bg: rgba(249, 115, 22, 0.06); --active-cell-bg: rgba(249, 115, 22, 0.12); }
    body[data-theme="green"] { --primary-color: #22c55e; --primary-hover: #16a34a; --text-accent: #4ade80; --body-bg: #050f09; --container-bg: #0f1a14; --cell-bg: #1a2e24; --grid-line: #3f6251; --given-text: #ffffff; --error-text: #f87171; --highlight-bg: var(--primary-color); --highlight-text: var(--given-text); --area-highlight-bg: rgba(34, 197, 94, 0.06); --active-cell-bg: rgba(34, 197, 94, 0.12); }
    body[data-theme="light"] { --primary-color: #a16207; --primary-hover: #854d0e; --text-accent: #a16207; --body-bg: #f1f5f9; --container-bg: #ffffff; --cell-bg: #f8fafc; --grid-line: #e2e8f0; --given-text: #374151; --error-text: #dc2626; --highlight-bg: #fde047; --highlight-text: var(--primary-hover); --area-highlight-bg: rgba(161, 98, 7, 0.05); --active-cell-bg: rgba(161, 98, 7, 0.1); }
    body[data-theme="black"] { --primary-color: #6b7280; --primary-hover: #4b5563; --text-accent: #d1d5db; --body-bg: #000000; --container-bg: #111827; --cell-bg: #1f2937; --grid-line: #4b5563; --given-text: #ffffff; --error-text: #ef4444; --highlight-bg: #9ca3af; --highlight-text: #000000; --area-highlight-bg: rgba(255, 255, 255, 0.05); --active-cell-bg: rgba(255, 255, 255, 0.1); }
    body[data-theme="pink"] { --primary-color: #ec4899; --primary-hover: #db2777; --text-accent: #f472b6; --body-bg: #1a0810; --container-bg: #2a0f1c; --cell-bg: #3a1628; --grid-line: #6d284f; --given-text: #ffffff; --error-text: #fca5a5; --highlight-bg: var(--primary-color); --highlight-text: var(--given-text); --area-highlight-bg: rgba(236, 72, 153, 0.06); --active-cell-bg: rgba(236, 72, 153, 0.12); }
    body[data-theme="turquoise"] { --primary-color: #14b8a6; --primary-hover: #0d9488; --text-accent: #2dd4bf; --body-bg: #040f0d; --container-bg: #0a1a17; --cell-bg: #112e29; --grid-line: #1f6259; --given-text: #ffffff; --error-text: #fca5a5; --highlight-bg: var(--primary-color); --highlight-text: #040f0d; --area-highlight-bg: rgba(20, 184, 166, 0.06); --active-cell-bg: rgba(20, 184, 166, 0.12); }

    /* --- Общие стили --- */
    body { background-color: var(--body-bg); color: var(--text-accent); transition: background-color 0.3s; }
    #game-container { transition: transform 0.2s ease-in-out; background-color: var(--container-bg); width: 100%; max-width: 420px; margin: auto; }
    @media (min-width: 768px) { #game-container { max-width: 600px; } }
    @media (min-width: 1024px) { #game-container { max-width: 640px; } }
    .glow { box-shadow: 0 0 10px color-mix(in srgb, var(--primary-color) 50%, transparent); }
    .title-text { color: var(--primary-color); }
    .control-button, .select-box { background-color: var(--cell-bg); color: var(--text-accent); }
    .main-button { background-color: var(--primary-color); color: white; }
    .main-button:hover { background-color: var(--primary-hover); }
    .grid-container { display: grid; grid-template-columns: repeat(9, minmax(0, 1fr)); gap: 2px; position: relative; width: 100%; padding: 3px; border-radius: 12px; background-color: var(--grid-line); }
    .cell { transition: background-color 0.2s ease-in-out; width: 100%; height: 0; padding-bottom: 100%; position: relative; border: none; border-radius: 6px; font-size: clamp(1rem, 4.5vw, 1.75rem); caret-color: transparent; background-color: var(--cell-bg); }
    .cell-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
    .error .cell-content { color: var(--error-text); }
    /* ИСПРАВЛЕНИЕ: Чёткое разделение стилей */
    .given .cell-content { color: var(--given-text); font-weight: 700; }
    .user-input .cell-content { color: var(--primary-color); font-weight: 500; }
    
    .grid-separator { position: absolute; z-index: 1; background-color: var(--primary-color); }
    .v-sep-1 { left: 33.333%; right: 33.333%; top: 3px; bottom: 3px; width: 2px; transform: translateX(-1px); }
    .v-sep-2 { left: 66.666%; right: 0; top: 3px; bottom: 3px; width: 2px; transform: translateX(-1px); }
    .h-sep-1 { top: 33.333%; bottom: 33.333%; left: 3px; right: 3px; height: 2px; transform: translateY(-1px); }
    .h-sep-2 { top: 66.666%; bottom: 0; left: 3px; right: 3px; height: 2px; transform: translateY(-1px); }
    .number-button { width: 100%; height: 0; padding-bottom: 100%; position: relative; }
    .number-button-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: clamp(1rem, 4vw, 1.5rem); border-radius: 0.375rem; background-color: var(--cell-bg); color: var(--text-accent); transition: background-color 0.2s; }
    .number-button-wrapper.selected .number-button-content { background-color: var(--primary-color); color: var(--given-text); }
    .number-button-wrapper.disabled .number-button-content { opacity: 0.4; cursor: not-allowed; }
    .number-counter { font-size: 0.6rem; position: absolute; bottom: 4px; right: 5px; opacity: 0.7; }
    .area-highlight { background-color: var(--area-highlight-bg); }
    .active-cell { background-color: var(--active-cell-bg) !important; }
    .highlight { background-color: var(--highlight-bg) !important; z-index: 5; }
    .highlight .cell-content { color: var(--highlight-text) !important; font-weight: 700; }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-2 sm:p-4">
  <div id="game-container" class="rounded-2xl p-4 glow">
    <h1 class="title-text text-2xl font-bold text-center mb-4">Я тебя люблю!</h1>
    <div class="mb-4 flex justify-between items-center">
      <select id="difficulty" class="select-box rounded-lg p-2 glow text-sm">
        <option value="easy">Изи</option> <option value="medium">Жизи</option> <option value="hard">Жоппи</option>
      </select>
      <div class="flex items-center gap-2 sm:gap-4 relative">
        <button id="clear-button" class="control-button p-2 rounded-lg glow transition-colors" title="Очистить поле"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-4.991-2.695v-2.695A8.25 8.25 0 005.67 6.75v2.695m12.663 0V6.75a8.25 8.25 0 00-11.664 0v2.695" /></svg></button>
        <button id="zoom-out-button" class="control-button p-2 rounded-lg glow transition-colors" title="Уменьшить"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM13.5 10.5h-6" /></svg></button>
        <button id="zoom-in-button" class="control-button p-2 rounded-lg glow transition-colors" title="Увеличить"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" /></svg></button>
        <button id="settings-button" class="control-button p-2 rounded-lg glow transition-colors" title="Настройки темы"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-1.007 1.11-1.11.55-.102 1.13-.102 1.68 0 .55.103 1.02.568 1.11 1.11.09.542.09 1.128 0 1.67-.09.542-.56 1.007-1.11 1.11-.55-.102-1.13-.102-1.68 0-.55-.103-1.02-.568-1.11-1.11-.09-.542-.09-1.128 0-1.67zM14.25 10.25a2.25 2.25 0 00-2.25-2.25H7.5a2.25 2.25 0 00-2.25 2.25v.5c0 .59.38 1.095.92 1.254a2.25 2.25 0 011.68.026l.22.067.22.067.22.067a2.25 2.25 0 011.13 1.933V16.5a2.25 2.25 0 002.25 2.25h.5a2.25 2.25 0 002.25-2.25v-2.25a2.25 2.25 0 00-1.13-1.933l-.22-.067-.22-.067-.22-.067a2.25 2.25 0 01-1.68-.026 1.125 1.125 0 01-.92-1.254v-.5z" /></svg></button>
        <div id="theme-panel" class="hidden absolute top-full right-0 mt-2 p-2 bg-gray-800 rounded-lg shadow-lg z-20"><div class="flex gap-2 flex-wrap max-w-xs justify-end"><button class="theme-button w-6 h-6 rounded-full bg-purple-500 border-2" data-theme="purple"></button><button class="theme-button w-6 h-6 rounded-full bg-orange-500 border-2" data-theme="orange"></button><button class="theme-button w-6 h-6 rounded-full bg-green-500 border-2" data-theme="green"></button><button class="theme-button w-6 h-6 rounded-full bg-gray-500 border-2" data-theme="black"></button><button class="theme-button w-6 h-6 rounded-full bg-pink-500 border-2" data-theme="pink"></button><button class="theme-button w-6 h-6 rounded-full bg-teal-500 border-2" data-theme="turquoise"></button><button class="theme-button w-6 h-6 rounded-full bg-yellow-700 border-2" data-theme="light"></button></div></div>
        <div id="timer" class="timer-text font-semibold text-sm">00:00</div>
      </div>
    </div>
    <div id="grid" class="grid-container mx-auto"><div class="grid-separator v-sep-1"></div><div class="grid-separator v-sep-2"></div><div class="grid-separator h-sep-1"></div><div class="grid-separator h-sep-2"></div></div>
    <div id="number-row" class="grid grid-cols-10 gap-1 sm:gap-2 mt-4 mx-auto"></div>
    <div class="mt-4 flex justify-between gap-2">
      <button id="newGame" class="main-button text-white px-3 py-2 rounded-lg glow text-sm flex-grow sm:flex-grow-0">Нью гей</button>
      <button id="highlightToggle" class="main-button text-white px-3 py-2 rounded-lg glow text-sm flex-grow sm:flex-grow-0">Подсветка</button>
      <button id="check" class="main-button text-white px-3 py-2 rounded-lg glow text-sm flex-grow sm:flex-grow-0">Провера</button>
    </div>
    <p id="message" class="mt-4 text-center text-sm h-5"></p>
  </div>

  <script>
    const elements = { body: document.body, gameContainer: document.getElementById('game-container'), grid: document.getElementById('grid'), difficulty: document.getElementById('difficulty'), newGameBtn: document.getElementById('newGame'), checkBtn: document.getElementById('check'), highlightBtn: document.getElementById('highlightToggle'), timer: document.getElementById('timer'), message: document.getElementById('message'), numberRow: document.getElementById('number-row'), clearBtn: document.getElementById('clear-button'), zoomInBtn: document.getElementById('zoom-in-button'), zoomOutBtn: document.getElementById('zoom-out-button'), settingsBtn: document.getElementById('settings-button'), themePanel: document.getElementById('theme-panel')};
    let grid = [], solution = [], givenCells = new Set(), timerInterval, startTime, activeCell = null, activeTool = null, highlightEnabled = true, currentScale = 1;

    function createGrid() { /* ... */ elements.grid.innerHTML='<div class="grid-separator v-sep-1"></div><div class="grid-separator v-sep-2"></div><div class="grid-separator h-sep-1"></div><div class="grid-separator h-sep-2"></div>';grid=Array(9).fill().map(()=>Array(9).fill(0));givenCells.clear();for(let i=0;i<9;i++)for(let j=0;j<9;j++){const e=document.createElement("div");e.className="cell";const t=document.createElement("div");t.className="cell-content";e.appendChild(t),e.addEventListener("click",(t)=>{t.stopPropagation();handleCellClick(i,j)}),elements.grid.appendChild(e)}}
    function createNumberRow() { /* ... */ elements.numberRow.innerHTML="";for(let i=1;i<=9;i++){const e=document.createElement("div");e.className="number-button-wrapper",e.dataset.tool=i,e.innerHTML=`<div class="number-button"><div class="number-button-content"><span>${i}</span><span class="number-counter">9</span></div></div>`,e.addEventListener("click",()=>{e.classList.contains("disabled")||selectTool(i)}),elements.numberRow.appendChild(e)}const e=document.createElement("div");e.className="number-button-wrapper",e.dataset.tool="erase",e.innerHTML=`<div class="number-button"><div class="number-button-content"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg></div></div>`,e.addEventListener("click",()=>selectTool("erase")),elements.numberRow.appendChild(e)}
    function generatePuzzle(difficulty) { /* ... */ solution=Array(9).fill().map(()=>Array(9).fill(0)),fillDiagonal(),fillRemaining(0,0),grid=solution.map(e=>e.slice());const e=[];for(let t=0;t<9;t++)for(let n=0;n<9;n++)e.push([t,n]);shuffle(e);const t={easy:45,medium:52,hard:58}[difficulty];for(let n=0;n<t;n++){const[l,s]=e[n];grid[l][s]=0}givenCells.clear();for(let n=0;n<9;n++)for(let l=0;l<9;l++)0!==grid[n][l]&&givenCells.add(`${n},${l}`);renderGrid();function fillDiagonal(){for(let e=0;e<9;e+=3){const t=[1,2,3,4,5,6,7,8,9];shuffle(t);let n=0;for(let l=0;l<3;l++)for(let s=0;s<3;s++)solution[e+l][e+s]=t[n++]}}function isSafe(e,t,n){for(let l=0;l<9;l++)if(solution[e][l]===n||solution[l][t]===n)return!1;const l=e-e%3,s=t-t%3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(solution[l+e][s+t]===n)return!1;return!0}function fillRemaining(e,t){if(t>=9&&(e++,t=0),e>=9)return!0;if(0!==solution[e][t])return fillRemaining(e,t+1);const n=[1,2,3,4,5,6,7,8,9];shuffle(n);for(let l of n)if(isSafe(e,t,l)){if(solution[e][t]=l,fillRemaining(e,t+1))return!0;solution[e][t]=0}return!1}function shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}}
    
    function handleCellClick(row, col) { (activeTool!==null)?(grid[row][col]===0||(grid[row][col]!==0&&activeTool==='erase'))?performAction(activeTool,row,col):(selectTool(null),selectCell(row,col)):selectCell(row,col)}
    function selectCell(row, col) { clearHighlights(),activeCell=[row,col];const e=document.querySelectorAll(".cell");e.forEach((t,n)=>{const l=Math.floor(n/9),s=n%9,c=l===row,r=s===col,o=Math.floor(l/3)===Math.floor(row/3)&&Math.floor(s/3)===Math.floor(col/3);(c||r||o)&&t.classList.add("area-highlight")}),e[9*row+col].classList.add("active-cell"),highlightEnabled&&0!==grid[row][col]&&highlightSimilarNumbers(grid[row][col])}
    function performAction(action, row, col) { if(givenCells.has(`${row},${col}`)) return; const value = (action === 'erase') ? 0 : action; if(grid[row][col] === value) return; const cellElement = document.querySelectorAll(".cell")[row * 9 + col]; grid[row][col] = value; cellElement.querySelector(".cell-content").textContent = value || ''; cellElement.classList.remove('error'); cellElement.classList.toggle('user-input', value !== 0); updateNumberPanelState(); if(highlightEnabled) { clearHighlights(true); if (value !== 0) highlightSimilarNumbers(value); }}
    function selectTool(tool) { activeTool = (activeTool === tool) ? null : tool; updateToolSelection(); if (activeTool === null && activeCell) { const [r,c] = activeCell; if (grid[r][c] === 0) deselectCell(); } else if (activeTool === null) { deselectCell(); } }
    function updateToolSelection() { document.querySelectorAll('.number-button-wrapper').forEach(btn => btn.classList.toggle('selected', btn.dataset.tool == activeTool)); }
    function deselectCell() { activeCell && (clearHighlights(), activeCell = null); if (activeTool !== null) { activeTool = null; updateToolSelection(); } }
    
    function renderGrid() { document.querySelectorAll(".cell").forEach((e,t)=>{const n=Math.floor(t/9),l=t%9;e.querySelector(".cell-content").textContent=grid[n][l]||"",e.className="cell",givenCells.has(`${n},${l}`)?e.classList.add("given"):0!==grid[n][l]&&e.classList.add("user-input")}),activeCell=null,activeTool=null,updateToolSelection(),clearHighlights(),resetTimer(),updateNumberPanelState()}
    function updateNumberPanelState() {
        const counts = Array(10).fill(0);
        for (let row of grid) for (let cell of row) if (cell !== 0) counts[cell]++;
        elements.numberRow.querySelectorAll(".number-button-wrapper").forEach((wrapper, index) => {
            if (index < 9) {
                const num = index + 1;
                const isExhausted = counts[num] === 9;
                wrapper.querySelector(".number-counter").textContent = 9 - counts[num];
                wrapper.classList.toggle("disabled", isExhausted);
                if (isExhausted && activeTool === num) {
                    selectTool(null);
                }
            }
        });
    }
    function checkSolution() { /* ... */ if(!grid.every(e=>e.every(e=>e)))return void(elements.message.textContent="Заполните все ячейки.");let e=!0;document.querySelectorAll(".cell").forEach((t,n)=>{const l=Math.floor(n/9),s=n%9;givenCells.has(`${l},${s}`)||t.classList.toggle("error",grid[l][s]!==solution[l][s])&&(e=!1)}),e?(clearInterval(timerInterval),elements.message.textContent="Поздравляем! Вы решили пазл!",elements.numberRow.querySelectorAll(".number-button-wrapper").forEach(e=>e.classList.add("disabled"))):elements.message.textContent="В решении есть ошибки."}
    function highlightSimilarNumbers(e){ if(!e) return; document.querySelectorAll(".cell").forEach((t,n)=>{if(grid[Math.floor(n/9)][n%9]===e)t.classList.add("highlight")})}
    function clearHighlights(keepArea = false){ document.querySelectorAll(".cell").forEach(e=>{e.classList.remove("highlight"),keepArea||e.classList.remove("area-highlight","active-cell")})}
    function resetTimer(){ /* ... */ clearInterval(timerInterval),startTime=Date.now(),timerInterval=setInterval(()=>{const e=Math.floor((Date.now()-startTime)/1e3),t=String(Math.floor(e/60)).padStart(2,"0"),n=String(e%60).padStart(2,"0");elements.timer.textContent=`${t}:${n}`},1e3)}
    function clearUserCells() { grid.forEach((row, r) => row.forEach((_, c) => { if (!givenCells.has(`${r},${c}`)) grid[r][c] = 0; })); renderGrid(); }
    function applyScale(scale) { currentScale = Math.max(0.5, Math.min(1.5, scale)); elements.gameContainer.style.transform = `scale(${currentScale})`; localStorage.setItem('sudoku-scale', currentScale); }
    function applyTheme(e){document.body.dataset.theme=e,localStorage.setItem("sudoku-theme",e),document.querySelectorAll(".theme-button").forEach(t=>{t.style.borderColor=t.dataset.theme===e?"var(--primary-color)":"transparent"})}

    function init() {
        const startNewGame = () => { createGrid(); createNumberRow(); generatePuzzle(elements.difficulty.value); elements.message.textContent = ""; };
        elements.newGameBtn.addEventListener('click', startNewGame);
        elements.checkBtn.addEventListener('click', checkSolution);
        elements.difficulty.addEventListener('change', startNewGame);
        elements.clearBtn.addEventListener('click', clearUserCells);
        elements.zoomInBtn.addEventListener('click', () => applyScale(currentScale + 0.1));
        elements.zoomOutBtn.addEventListener('click', () => applyScale(currentScale - 0.1));
        elements.highlightBtn.addEventListener('click', ()=>{highlightEnabled=!highlightEnabled,elements.highlightBtn.textContent=`Светильник: ${highlightEnabled?"ВКЛ":"ВЫКЛ"}`;if(!highlightEnabled){clearHighlights()}else{if(activeCell&&grid[activeCell[0]][activeCell[1]]){highlightSimilarNumbers(grid[activeCell[0]][activeCell[1]])}}});
        elements.settingsBtn.addEventListener('click', e => { e.stopPropagation(); elements.themePanel.classList.toggle('hidden'); });
        elements.themePanel.addEventListener('click', e => { e.stopPropagation(); if (e.target.closest('.theme-button')) { applyTheme(e.target.closest('.theme-button').dataset.theme); } });
        document.addEventListener('click', (e) => { if (!elements.gameContainer.contains(e.target)) deselectCell(); elements.themePanel.classList.add('hidden'); });
        
        applyTheme(localStorage.getItem('sudoku-theme') || 'purple');
        applyScale(parseFloat(localStorage.getItem('sudoku-scale')) || 1);
        startNewGame();
    }
    init();
  </script>
</body>
</html>
