<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
  <title>Судоку</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- ИЗМЕНЕНИЕ: Система тем на CSS-переменных --- */
    :root, body[data-theme="purple"] {
      --primary-color: #a855f7;
      --primary-hover: #9333ea;
      --text-accent: #c084fc;
      --body-bg: #030712;
      --container-bg: #111827;
      --cell-bg: #1f2937;
      --grid-line: #4b5563;
      --user-input: #67e8f9;
      --given-text: #ffffff;
      --error-text: #f87171;
    }
    body[data-theme="orange"] {
      --primary-color: #f97316;
      --primary-hover: #ea580c;
      --text-accent: #fb923c;
      --body-bg: #0c0a09;
      --container-bg: #1c1917;
      --cell-bg: #292524;
      --grid-line: #57534e;
      --user-input: #fdba74;
      --given-text: #ffffff;
      --error-text: #f87171;
    }
    body[data-theme="green"] {
      --primary-color: #22c55e;
      --primary-hover: #16a34a;
      --text-accent: #4ade80;
      --body-bg: #050f09;
      --container-bg: #0f1a14;
      --cell-bg: #1a2e24;
      --grid-line: #3f6251;
      --user-input: #86efac;
      --given-text: #ffffff;
      --error-text: #f87171;
    }
    body[data-theme="light"] {
      --primary-color: #a16207;
      --primary-hover: #854d0e;
      --text-accent: #a16207;
      --body-bg: #f1f5f9;
      --container-bg: #ffffff;
      --cell-bg: #f8fafc;
      --grid-line: #e2e8f0;
      --user-input: #1e40af;
      --given-text: #1e293b;
      --error-text: #dc2626;
    }

    body { background-color: var(--body-bg); color: var(--text-accent); transition: background-color 0.3s; }
    .glow { box-shadow: 0 0 10px color-mix(in srgb, var(--primary-color) 50%, transparent); }
    #game-container { background-color: var(--container-bg); }
    .title-text { color: var(--primary-color); }
    .control-button, .select-box { background-color: var(--cell-bg); color: var(--text-accent); }
    .control-button:hover { background-color: var(--grid-line); }
    .main-button { background-color: var(--primary-color); color: white; }
    .main-button:hover { background-color: var(--primary-hover); }
    .timer-text { color: var(--primary-color); }
    .grid-container { background-color: var(--grid-line); }
    .cell { background-color: var(--cell-bg); }
    .cell:focus { box-shadow: 0 0 15px color-mix(in srgb, var(--primary-color) 70%, transparent); }
    .grid-separator { background-color: var(--primary-color); }
    .given .cell-content { color: var(--given-text); }
    .user-input .cell-content { color: var(--user-input); }
    .error .cell-content { color: var(--error-text); }
    .number-button-content { background-color: var(--cell-bg); color: var(--text-accent); }
    .number-button-wrapper.selected .number-button-content { background-color: var(--primary-color); color: var(--given-text); }

    /* Общие стили без цветов */
    #game-container { width: 100%; max-width: 420px; margin: auto; }
    @media (min-width: 768px) { #game-container { max-width: 600px; } }
    @media (min-width: 1024px) { #game-container { max-width: 640px; } }
    .grid-container { display: grid; grid-template-columns: repeat(9, minmax(0, 1fr)); gap: 2px; position: relative; width: 100%; padding: 3px; border-radius: 12px; }
    .cell { transition: all 0.2s ease-in-out; width: 100%; height: 0; padding-bottom: 100%; position: relative; border: none; border-radius: 6px; font-size: clamp(1rem, 4.5vw, 1.75rem); font-weight: 500; caret-color: transparent; }
    .cell-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
    .error .cell-content, .given .cell-content { font-weight: 700; }
    .highlight { box-shadow: 0 0 15px rgba(132, 204, 22, 0.9); }
    .grid-separator { position: absolute; z-index: 1; }
    .v-sep-1 { left: 33.333%; right: 33.333%; top: 3px; bottom: 3px; width: 2px; transform: translateX(-1px); }
    .v-sep-2 { left: 66.666%; right: 0; top: 3px; bottom: 3px; width: 2px; transform: translateX(-1px); }
    .h-sep-1 { top: 33.333%; bottom: 33.333%; left: 3px; right: 3px; height: 2px; transform: translateY(-1px); }
    .h-sep-2 { top: 66.666%; bottom: 0; left: 3px; right: 3px; height: 2px; transform: translateY(-1px); }
    .number-button { width: 100%; height: 0; padding-bottom: 100%; position: relative; }
    .number-button-content { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: clamp(1rem, 4vw, 1.5rem); border-radius: 0.375rem; }
    .number-button-wrapper.disabled .number-button-content { opacity: 0.4; cursor: not-allowed; }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-2 sm:p-4">
  <div id="game-container" class="rounded-2xl p-4 glow">
    <h1 class="title-text text-2xl font-bold text-center mb-4">Судоку для Любимой</h1>
    <div class="mb-4 flex justify-between items-center">
      <select id="difficulty" class="select-box rounded-lg p-2 glow text-sm">
        <option value="easy">Лёгкий</option> <option value="medium">Средний</option> <option value="hard">Сложный</option>
      </select>
      <div class="flex items-center gap-2 sm:gap-4 relative">
        <button id="clear-button" class="control-button p-2 rounded-lg glow transition-colors" title="Очистить поле"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0011.664 0l3.181-3.183m-4.991-2.695v-2.695A8.25 8.25 0 005.67 6.75v2.695m12.663 0V6.75a8.25 8.25 0 00-11.664 0v2.695" /></svg></button>
        <button id="fullscreen-button" class="control-button p-2 rounded-lg glow transition-colors" title="Полный экран"><svg id="icon-expand" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" /></svg><svg id="icon-compress" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5M15 15l5.25 5.25" /></svg></button>
        <!-- ИЗМЕНЕНИЕ: Кнопка Настроек (тем) -->
        <button id="settings-button" class="control-button p-2 rounded-lg glow transition-colors" title="Настройки темы"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-1.007 1.11-1.11.55-.102 1.13-.102 1.68 0 .55.103 1.02.568 1.11 1.11.09.542.09 1.128 0 1.67-.09.542-.56 1.007-1.11 1.11-.55.102-1.13.102-1.68 0-.55-.103-1.02-.568-1.11-1.11-.09-.542-.09-1.128 0-1.67zM14.25 10.25a2.25 2.25 0 00-2.25-2.25H7.5a2.25 2.25 0 00-2.25 2.25v.5c0 .59.38 1.095.92 1.254a2.25 2.25 0 011.68.026l.22.067.22.067.22.067a2.25 2.25 0 011.13 1.933V16.5a2.25 2.25 0 002.25 2.25h.5a2.25 2.25 0 002.25-2.25v-2.25a2.25 2.25 0 00-1.13-1.933l-.22-.067-.22-.067-.22-.067a2.25 2.25 0 01-1.68-.026 1.125 1.125 0 01-.92-1.254v-.5z" /></svg></button>
        <div id="timer" class="timer-text font-semibold text-sm">00:00</div>
        <!-- Панель тем -->
        <div id="theme-panel" class="hidden absolute top-full right-0 mt-2 p-2 bg-gray-800 rounded-lg shadow-lg z-20">
            <div class="flex gap-2">
                <button class="theme-button w-6 h-6 rounded-full bg-purple-500 border-2" data-theme="purple" title="Фиолетовая"></button>
                <button class="theme-button w-6 h-6 rounded-full bg-orange-500 border-2" data-theme="orange" title="Оранжевая"></button>
                <button class="theme-button w-6 h-6 rounded-full bg-green-500 border-2" data-theme="green" title="Зелёная"></button>
                <button class="theme-button w-6 h-6 rounded-full bg-yellow-700 border-2" data-theme="light" title="Светлая (Кофе)"></button>
            </div>
        </div>
      </div>
    </div>
    <div id="grid" class="grid-container mx-auto"><div class="grid-separator v-sep-1"></div><div class="grid-separator v-sep-2"></div><div class="grid-separator h-sep-1"></div><div class="grid-separator h-sep-2"></div></div>
    <div id="number-row" class="grid grid-cols-9 gap-1 sm:gap-2 mt-4 mx-auto"></div>
    <div class="mt-4 flex justify-between gap-2">
      <button id="newGame" class="main-button text-white px-3 py-2 rounded-lg glow text-sm flex-grow sm:flex-grow-0">Новая игра</button>
      <button id="highlightToggle" class="main-button text-white px-3 py-2 rounded-lg glow text-sm flex-grow sm:flex-grow-0">Подсветка</button>
      <button id="check" class="main-button text-white px-3 py-2 rounded-lg glow text-sm flex-grow sm:flex-grow-0">Проверить</button>
    </div>
    <p id="message" class="mt-4 text-center text-sm h-5"></p>
  </div>

  <script>
    // --- Получаем все элементы ---
    const elements = {
        body: document.body,
        gameContainer: document.getElementById('game-container'),
        grid: document.getElementById('grid'),
        difficulty: document.getElementById('difficulty'),
        newGameBtn: document.getElementById('newGame'),
        checkBtn: document.getElementById('check'),
        highlightBtn: document.getElementById('highlightToggle'),
        timer: document.getElementById('timer'),
        message: document.getElementById('message'),
        numberRow: document.getElementById('number-row'),
        clearBtn: document.getElementById('clear-button'),
        fullscreenBtn: document.getElementById('fullscreen-button'),
        settingsBtn: document.getElementById('settings-button'),
        themePanel: document.getElementById('theme-panel'),
        iconExpand: document.getElementById('icon-expand'),
        iconCompress: document.getElementById('icon-compress')
    };
    
    // --- Глобальные переменные ---
    let grid = [], solution = [], givenCells = new Set(), timerInterval, startTime, selectedNumber = null, highlightEnabled = true;

    // --- Функции создания UI ---
    function createGrid() { /* ... без изменений ... */ elements.grid.innerHTML='<div class="grid-separator v-sep-1"></div><div class="grid-separator v-sep-2"></div><div class="grid-separator h-sep-1"></div><div class="grid-separator h-sep-2"></div>';grid=Array(9).fill().map(()=>Array(9).fill(0));givenCells.clear();for(let i=0;i<9;i++)for(let j=0;j<9;j++){const e=document.createElement("div");e.className="cell";const t=document.createElement("div");t.className="cell-content",e.appendChild(t),e.addEventListener("click",()=>handleCellClick(i,j,e,t)),elements.grid.appendChild(e)}createNumberRow()}
    function createNumberRow() { /* ... без изменений ... */ elements.numberRow.innerHTML="";for(let i=1;i<=9;i++){const e=document.createElement("div");e.className="number-button-wrapper";const t=document.createElement("div");t.className="number-button";const n=document.createElement("div");n.className="number-button-content",n.textContent=i,t.appendChild(n),e.appendChild(t),e.addEventListener("click",()=>{e.classList.contains("disabled")||(selectedNumber=selectedNumber===i?null:i,selectedNumber&&highlightEnabled?highlightSimilarNumbers(i):clearHighlights(),updateNumberSelection())}),elements.numberRow.appendChild(e)}}

    // --- Игровые механики ---
    function handleCellClick(i, j, wrapper, content) { /* ... без изменений ... */ if(givenCells.has(`${i},${j}`)){if(content.textContent)selectedNumber=parseInt(content.textContent),updateNumberSelection(),highlightEnabled&&highlightSimilarNumbers(selectedNumber);return}null!==selectedNumber?(grid[i][j]===selectedNumber?(content.textContent="",grid[i][j]=0,wrapper.classList.remove("user-input","error")):(content.textContent=selectedNumber,grid[i][j]=selectedNumber,wrapper.classList.remove("error"),wrapper.classList.add("user-input"),highlightEnabled&&highlightSimilarNumbers(selectedNumber)),updateNumberPanelState()):content.textContent&&(selectedNumber=parseInt(content.textContent),updateNumberSelection(),highlightEnabled&&highlightSimilarNumbers(selectedNumber))}
    function generatePuzzle(difficulty) { /* ... без изменений ... */ solution=Array(9).fill().map(()=>Array(9).fill(0)),fillDiagonal(),fillRemaining(0,0),grid=solution.map(e=>e.slice());const e=[];for(let t=0;t<9;t++)for(let n=0;n<9;n++)e.push([t,n]);shuffle(e);const t={easy:45,medium:52,hard:58}[difficulty];for(let n=0;n<t;n++){const[l,s]=e[n];grid[l][s]=0}givenCells.clear();for(let n=0;n<9;n++)for(let l=0;l<9;l++)0!==grid[n][l]&&givenCells.add(`${n},${l}`);renderGrid();function fillDiagonal(){for(let e=0;e<9;e+=3){const t=[1,2,3,4,5,6,7,8,9];shuffle(t);let n=0;for(let l=0;l<3;l++)for(let s=0;s<3;s++)solution[e+l][e+s]=t[n++]}}function isSafe(e,t,n){for(let l=0;l<9;l++)if(solution[e][l]===n||solution[l][t]===n)return!1;const l=e-e%3,s=t-t%3;for(let e=0;e<3;e++)for(let t=0;t<3;t++)if(solution[l+e][s+t]===n)return!1;return!0}function fillRemaining(e,t){if(t>=9&&(e++,t=0),e>=9)return!0;if(0!==solution[e][t])return fillRemaining(e,t+1);const n=[1,2,3,4,5,6,7,8,9];shuffle(n);for(let l of n)if(isSafe(e,t,l)){if(solution[e][t]=l,fillRemaining(e,t+1))return!0;solution[e][t]=0}return!1}function shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}}
    
    // --- Функции обновления состояния ---
    function renderGrid() {document.querySelectorAll(".cell").forEach((e,t)=>{const n=Math.floor(t/9),l=t%9;e.querySelector(".cell-content").textContent=grid[n][l]||"",e.className="cell",givenCells.has(`${n},${l}`)?e.classList.add("given"):0!==grid[n][l]&&e.classList.add("user-input")}),selectedNumber=null,updateNumberSelection(),clearHighlights(),resetTimer(),updateNumberPanelState()}
    function updateNumberPanelState() {const e=Array(10).fill(0);for(let t of grid)for(let n of t)0!==n&&e[n]++;elements.numberRow.querySelectorAll(".number-button-wrapper").forEach((t,n)=>{const l=n+1,s=9===e[l];t.classList.toggle("disabled",s),t.querySelector(".number-button-content").classList.toggle("opacity-40",s),s&&selectedNumber===l&&(selectedNumber=null,clearHighlights(),updateNumberSelection())})}
    function updateNumberSelection() {elements.numberRow.querySelectorAll(".number-button-wrapper").forEach((e,t)=>{e.classList.toggle("selected",t+1===selectedNumber)})}
    
    // --- Вспомогательные функции ---
    function startNewGame() {createGrid();generatePuzzle(elements.difficulty.value);elements.message.textContent=""}
    function checkSolution() {if(!grid.every(e=>e.every(e=>e)))return void(elements.message.textContent="Заполните все ячейки.");let e=!0;document.querySelectorAll(".cell").forEach((t,n)=>{const l=Math.floor(n/9),s=n%9;givenCells.has(`${l},${s}`)||t.classList.toggle("error",grid[l][s]!==solution[l][s])&&(e=!1)}),e?(clearInterval(timerInterval),elements.message.textContent="Поздравляем! Вы решили пазл!",elements.numberRow.querySelectorAll(".number-button-wrapper").forEach(e=>e.classList.add("disabled"))):elements.message.textContent="В решении есть ошибки."}
    function clearUserCells() {document.querySelectorAll(".cell").forEach((e,t)=>{const n=Math.floor(t/9),l=t%9;givenCells.has(`${n},${l}`)||(grid[n][l]=0,e.querySelector(".cell-content").textContent="",e.classList.remove("user-input","error"))}),selectedNumber&&clearHighlights(),elements.message.textContent="",updateNumberPanelState()}
    function highlightSimilarNumbers(e){clearHighlights(),document.querySelectorAll(".cell").forEach((t,n)=>{grid[Math.floor(n/9)][n%9]===e&&t.classList.add("highlight")})}
    function clearHighlights(){document.querySelectorAll(".cell.highlight").forEach(e=>e.classList.remove("highlight"))}
    function resetTimer(){clearInterval(timerInterval),startTime=Date.now(),timerInterval=setInterval(()=>{const e=Math.floor((Date.now()-startTime)/1e3),t=String(Math.floor(e/60)).padStart(2,"0"),n=String(e%60).padStart(2,"0");elements.timer.textContent=`${t}:${n}`},1e3)}

    // --- Функции управления UI (Темы, Полный экран) ---
    function applyTheme(theme) {
        elements.body.dataset.theme = theme;
        localStorage.setItem('sudoku-theme', theme);
        document.querySelectorAll('.theme-button').forEach(btn => {
            btn.style.borderColor = btn.dataset.theme === theme ? 'var(--primary-color)' : 'transparent';
        });
    }
    function toggleFullScreen() {document.fullscreenElement?document.exitFullscreen():elements.gameContainer.requestFullscreen().catch(e=>alert(`Ошибка: ${e.message}`))}
    function updateFullscreenIcons() {const e=!!document.fullscreenElement;elements.iconExpand.classList.toggle("hidden",e),elements.iconCompress.classList.toggle("hidden",!e)}

    // --- Инициализация и слушатели событий ---
    function init() {
        elements.newGameBtn.addEventListener('click', startNewGame);
        elements.checkBtn.addEventListener('click', checkSolution);
        elements.clearBtn.addEventListener('click', clearUserCells);
        elements.difficulty.addEventListener('change', startNewGame);
        elements.highlightBtn.addEventListener('click', () => {highlightEnabled=!highlightEnabled,elements.highlightBtn.textContent=`Подсветка: ${highlightEnabled?"ВКЛ":"ВЫКЛ"}`,highlightEnabled?selectedNumber&&highlightSimilarNumbers(selectedNumber):clearHighlights()});
        elements.fullscreenBtn.addEventListener('click', toggleFullScreen);
        document.addEventListener('fullscreenchange', updateFullscreenIcons);
        elements.settingsBtn.addEventListener('click', (e) => { e.stopPropagation(); elements.themePanel.classList.toggle('hidden'); });
        document.addEventListener('click', () => elements.themePanel.classList.add('hidden'));
        elements.themePanel.addEventListener('click', (e) => {
            e.stopPropagation();
            if (e.target.classList.contains('theme-button')) {
                applyTheme(e.target.dataset.theme);
                elements.themePanel.classList.add('hidden');
            }
        });
        
        applyTheme(localStorage.getItem('sudoku-theme') || 'purple');
        startNewGame();
    }

    init();
  </script>
</body>
</html>
